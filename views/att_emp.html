<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title><%= title %> - business 360Â°</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome5-overrides.min.css">
    <link rel="stylesheet" href="assets/css/Billing-Table-with-Add-Row--Fixed-Header-Feature.css">
    <link rel="stylesheet" href="assets/css/Contact-Form-by-Moorcam.css">
    <link rel="stylesheet" href="assets/css/Features-Cards-icons.css">
    <link rel="stylesheet" href="assets/css/Pretty-Table-tables.css">
    <link rel="stylesheet" href="assets/css/Pretty-Table.css">
    <link rel="stylesheet" href="assets/css/Profile-Edit-Form-styles.css">
    <link rel="stylesheet" href="assets/css/Profile-Edit-Form.css">
</head>

<body id="page-top">
     <div id="wrapper">
        <nav class="navbar align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0 navbar-dark">
            <div class="container-fluid d-flex flex-column p-0"><a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
                    <div class="sidebar-brand-icon rotate-n-15"><i class="fas fa-laugh-wink"></i></div>
                    <div class="sidebar-brand-text mx-3"><span>business 360Â°</span></div>
                </a>
                <hr class="sidebar-divider my-0">
                <ul class="navbar-nav text-light" id="accordionSidebar">
                    <li class="nav-item"><a class="nav-link" href="/"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/profile"><i class="fas fa-user"></i><span>Profile</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/employee"><i class="fas fa-table"></i><span>Employee</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/inventory"><i class="fas fa-boxes fa-fw me-2"></i><span>Inventory</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/billing"> <i class="fas fa-file-invoice-dollar fa-fw me-2"></i><span>Billing</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/sales"> <i class="fas fa-chart-bar fa-fw me-2"></i><span>Sales dashboard</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="/finance"><i class="fas fa-money-bill-wave fa-fw me-2"></i><span>fiance dashboard</span></a></li>
                </ul>
                <div class="text-center d-none d-md-inline"><button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button></div>
            </div>
        </nav>
       <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
                    <div class="container-fluid">
                        <!-- Sidebar Toggle -->
                        <button class="btn btn-link d-md-none rounded-circle me-3" id="sidebarToggleTop" type="button">
                            <i class="fas fa-bars"></i>
                        </button>
                        
                        <!-- Greeting - Responsive -->
                        <div class="d-flex align-items-center flex-grow-1">
                            <div class="me-3">
                                <h5 class="mb-0 text-gray-800 d-flex align-items-center">
                                   <i class="fas fa-sun text-warning me-2" id="greetingIcon"></i>
                                    <span class="d-none d-sm-inline" id="greetingText">Good Morning,</span>
                                 </h5>
                                <small class="text-muted d-none d-md-inline">Welcome back to your business dashboard</small>
                            </div>
                        </div>
                        
                        <!-- Right side of navbar -->
                        <ul class="navbar-nav ms-auto">
                            <!-- Calendar - Responsive -->
                            <li class="nav-item">
                                <div class="d-flex align-items-center px-3 py-2 bg-light rounded-pill" id="dateContainer">
                                    <i class="fas fa-calendar-day text-primary me-2"></i>
                                    <span class="me-1 fw-semibold d-none d-sm-inline">Today:</span>
                                    <span class="d-none d-md-inline" id="fullDate">Thursday, July 10, 2025</span>
                                    <span class="d-inline d-md-none" id="shortDate">Jul 10</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav> 
              <!--**************************************************************************************************************************************************************************************************************************************************************-->
              <!-- starting section -->
               <!--attandance -->
<div class="container-fluid my-5">
    <div class="row">
        <div class="col-12">
            <div class="card shadow border-0 rounded-lg">
                <div class="card-header bg-gradient-primary text-white py-3">
                    <div class="row align-items-center">
                        <div class="col">
                            <h5 class="m-0 font-weight-bold">Employee Attendance</h5>
                            <p class="text-white-50 small mb-0">Track daily attendance records</p>
                        </div>
                        <div class="col-auto">
                            <div class="input-group">
                                <input type="date" id="attendanceDate" class="form-control form-control-sm bg-light border-0" value="<%= currentDate %>">
                                <button id="searchDateBtn" class="btn btn-light btn-sm"><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0 align-middle">
                            <thead class="bg-light">
                                <tr>
                                    <th class="py-3 px-4">ID</th>
                                    <th class="py-3">Name</th>
                                    <th class="py-3">Department</th>
                                    <th class="py-3">Date</th>
                                    <th class="py-3">Status</th>
                                    <th class="py-3">Leave Type</th>
                                    <th class="py-3">Reason</th>
                                    <th class="py-3 text-end pe-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <% if(attendance && attendance.length > 0) { %>
                                    <% attendance.forEach(record => { %>
                                        <tr data-employee-id="<%= record.employee_id %>">
                                            <td class="py-3 px-4 fw-bold text-primary"><%= record.employee_id %></td>
                                            <td>
                                                <div><%= record.name %></div>
                                            </td>
                                            <td><%= record.department %></td>
                                            <td><%= displayDate %></td>
                                            <td>
                                                <select class="form-select form-select-sm status-select">
                                                    <option value="present" <%= record.status === 'present' ? 'selected' : '' %>>ï¿½ Present</option>
                                                    <option value="leave" <%= record.status === 'leave' ? 'selected' : '' %>>ðŸ”´ Leave</option>
                                                    <option value="absent" <%= record.status === 'absent' ? 'selected' : '' %>>âšª Absent</option>
                                                    <option value="half-day" <%= record.status === 'half-day' ? 'selected' : '' %>>ðŸŸ¡ Half Day</option>
                                                </select>
                                            </td>
                                            <td>
                                                <select class="form-select form-select-sm leave-type-select" <%= record.status === 'present' ? 'disabled' : '' %>>
                                                    <option value="">Select Type</option>
                                                    <option value="sick" <%= record.leave_type === 'sick' ? 'selected' : '' %>>Sick</option>
                                                    <option value="paid" <%= record.leave_type === 'paid' ? 'selected' : '' %>>Paid</option>
                                                    <option value="unpaid" <%= record.leave_type === 'unpaid' ? 'selected' : '' %>>Unpaid</option>
                                                    <option value="emergency" <%= record.leave_type === 'emergency' ? 'selected' : '' %>>Emergency</option>
                                                    <option value="other" <%= record.leave_type === 'other' ? 'selected' : '' %>>Other</option>
                                                </select>
                                            </td>
                                            <td>
                                                <input type="text" class="form-control form-control-sm reason-input" 
                                                    value="<%= record.reason || '' %>" 
                                                    placeholder="Enter reason" 
                                                    <%= record.status === 'present' ? 'disabled' : '' %>>
                                            </td>
                                            <td class="text-end pe-4">
                                                <button class="btn btn-sm btn-outline-success save-btn"><i class="fas fa-save"></i></button>
                                            </td>
                                        </tr>
                                    <% }); %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="8" class="text-center py-4">No attendance records found for this date.</td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-light p-3 border-0">
                    <div class="row align-items-center">
                        <div class="col">
                            <select class="form-select form-select-sm w-auto">
                                <option>10 rows</option>
                                <option>25 rows</option>
                                <option>50 rows</option>
                            </select>
                        </div>
                        <div class="col-auto">
                            <nav>
                                <ul class="pagination pagination-sm mb-0">
                                    <li class="page-item disabled"><a class="page-link" href="#"><i class="fas fa-chevron-left"></i></a></li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item"><a class="page-link" href="#"><i class="fas fa-chevron-right"></i></a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
                <!-- End SECTION -->

                <!--***********************************************************************************************************************************************************************************************************************************************-->
            <footer class="bg-white sticky-footer">
                <div class="container my-auto">
                    <div class="text-center my-auto copyright"><span>Copyright Â© business 360Â° 2025</span></div>
                </div>
            </footer>
        </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
    </div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="assets/js/Billing-Table-with-Add-Row--Fixed-Header-Feature-Billing-Table-with-Add-Row--Fixed-Header.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="assets/js/Profile-Edit-Form-profile.js"></script>
    <script src="assets/js/theme.js"></script>
    <script src="assets/js/topnav.js"></script>

    <!-- Custom Script for Attendance Table Functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Enable/disable leave type and reason based on status selection
            const statusSelects = document.querySelectorAll('.status-select');
            
            statusSelects.forEach(select => {
                // Initial setup
                updateDependentFields(select);
                
                // Event listener for changes
                select.addEventListener('change', function() {
                    updateDependentFields(this);
                });
            });
            
            // Date search functionality
            document.getElementById('searchDateBtn').addEventListener('click', function() {
                const selectedDate = document.getElementById('attendanceDate').value;
                if (selectedDate) {
                    window.location.href = `/attendance?date=${selectedDate}`;
                }
            });
            
            // Save button functionality
            const saveButtons = document.querySelectorAll('.save-btn');
            saveButtons.forEach(btn => {
                btn.addEventListener('click', async function() {
                    const row = this.closest('tr');
                    const employeeId = row.getAttribute('data-employee-id');
                    const status = row.querySelector('.status-select').value;
                    const leaveType = row.querySelector('.leave-type-select').value;
                    const reason = row.querySelector('.reason-input').value;
                    const date = document.getElementById('attendanceDate').value;
                    
                    // Validate data
                    if (status !== 'present' && !leaveType) {
                        alert('Please select a leave type.');
                        return;
                    }
                    
                    // Prepare data for sending
                    const attendanceData = {
                        employee_id: employeeId,
                        date: date,
                        status: status,
                        leave_type: status !== 'present' ? leaveType : '',
                        reason: status !== 'present' ? reason : ''
                    };
                    
                    try {
                        // Show loading state
                        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                        btn.disabled = true;
                        
                        // Send data to server
                        const response = await fetch('/attendance/save', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(attendanceData),
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            // Show success message
                            btn.innerHTML = '<i class="fas fa-check"></i>';
                            setTimeout(() => {
                                btn.innerHTML = '<i class="fas fa-save"></i>';
                                btn.disabled = false;
                            }, 2000);
                            
                            // Optional: Show a toast or notification
                            alert('Attendance record updated successfully!');
                        } else {
                            // Show error
                            btn.innerHTML = '<i class="fas fa-times"></i>';
                            setTimeout(() => {
                                btn.innerHTML = '<i class="fas fa-save"></i>';
                                btn.disabled = false;
                            }, 2000);
                            
                            alert('Error: ' + (result.message || 'Could not save attendance'));
                        }
                    } catch (error) {
                        console.error('Error saving attendance:', error);
                        btn.innerHTML = '<i class="fas fa-times"></i>';
                        setTimeout(() => {
                            btn.innerHTML = '<i class="fas fa-save"></i>';
                            btn.disabled = false;
                        }, 2000);
                        
                        alert('An error occurred while saving attendance');
                    }
                });
            });
            
            // Function to update dependent fields based on status
            function updateDependentFields(statusSelect) {
                const row = statusSelect.closest('tr');
                const leaveTypeSelect = row.querySelector('.leave-type-select');
                const reasonInput = row.querySelector('.reason-input');
                
                if (statusSelect.value === 'present') {
                    leaveTypeSelect.disabled = true;
                    leaveTypeSelect.value = '';
                    reasonInput.disabled = true;
                    reasonInput.value = '';
                } else {
                    leaveTypeSelect.disabled = false;
                    reasonInput.disabled = false;
                }
            }
        });
    </script>
</body>

</html>